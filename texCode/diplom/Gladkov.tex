% !TeX encoding = windows-1251
\documentclass[a4paper,12pt]{diplom}
\inputencoding{cp1251} % Кодировка вашего файла
\usepackage{paratype} % Шрифты (можно отключить, если дает ошибку)
%% Немного увеличим шрифт в математическом режиме, чтобы соответствовать размерам Paratype-шрифтов
\DeclareMathSizes{12}{13.4}{11}{10}

\usepackage[left=3cm,right=2cm,top=2cm,bottom=2cm]{geometry} % Размеры полей
\usepackage[onehalfspacing]{setspace} % Полуторный интервал
%\renewcommand{\baselinestretch}{1.25} % Полуторный интервал
\usepackage{indentfirst} % Абзацный отступ в начале разделов
\setlength{\parindent}{1.25cm} % Величина абзацного отступа

\usepackage[pdftex]{graphicx} % Для вставки изображений
\usepackage{array} % Для таблиц
\usepackage{booktabs} % Для красивых таблиц 
\usepackage{tikz} % Рисунки с помощью TikZ
\usepackage[linesnumbered,lined,ruled]{algorithm2e} % Для оформления псевдокода
%\usepackage{algorithm} % Альтернатива оформления псевдокода
%\usepackage{algpseudocode} % Альтернатива оформления псевдокода
\usepackage{listings} % Оформление листингов программ
\usepackage{icomma} % Удаляем тонкий пробел после запятой в мат. режиме

% Если на нумерованную формулу нет ссылки в тексте,
\mathtoolsset{showonlyrefs} % то она становится ненумерованной

% microtype улучшает распределение символов в строке
\usepackage{microtype}  % Можно отключить, если возникают ошибки компиляции
\usepackage{subfig}

\usepackage{pdflscape}% для твблицы а альбомной ориентации
\usepackage{afterpage}

\usepackage{siunitx}%для табличек
\usepackage{makecell}
\renewcommand{\theadfont}{\normalsize\bfseries}
\renewcommand{\arraystretch}{1.3}

\usepackage{adjustbox}% чтобы повернуть таблицу
\usepackage{rotating}


% Формируем PDF с полноценными перекрестными ссылками
\usepackage[unicode, pdfborder={0 0 0}, pdfstartview=FitV]{hyperref}

% Часто используемые макросы
\newcommand{\N}{\mathbb{N}}  % Множество натуральных чисел
\newcommand{\Z}{\mathbb{Z}}  % Множество целых чисел
\newcommand{\R}{\mathbb{R}}  % Множество действительных чисел
\DeclareMathOperator{\sgn}{sgn} % Знак числа
\DeclareMathOperator{\M}{\mathsf{M}} % Матожидание
\newcommand{\from}{\colon} % Двоеточие в определении функции. Пример: $f \from \R \to \N$.
% Заменяем англоязычные обозначения на русские
\renewcommand{\le}{\leqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\ge}{\geqslant}
\renewcommand{\geq}{\geqslant}
\renewcommand{\emptyset}{\varnothing}
\renewcommand{\epsilon}{\varepsilon}

% Директория с картинками
\graphicspath{ {./images/} }

\newtheorem{algoritm}{Алгоритм} 
\newtheorem{definition}{Определение} 
\newtheorem{weight}{Распределение весов}
\newtheorem{metric}{Метрика}
\newtheorem{statement}{Утверждение}

%%%%%%%%%%%%%%%%%%%%%%%%%%
% Конец преамбулы
%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

% Содержимое титульного листа

\LetterHead{\textbf{МИНОБРНАУКИ РОССИИ \\ Федеральное государственное бюджетное образовательное\\ учреждение высшего образования\\ «Ярославский государственный университет имени П. Г. Демидова»}}

\Napr{по направлению подготовки 02.03.02 Фундаментальная информатика и \\информационные технологии}

\Kafedra{Кафедра теоретической информатики}

% Зав. кафедрой
\ZavKaf{Заведующий кафедрой,\\ д.\,ф.-м.\,н., доцент}{Е.\,В.~Кузьмин}
% Если это курсовая работа и виза зав. каф. не нужна, раскомментируйте следующую строку
%\Kursovaya

% Вид работы: Курсовая работа, Выпускная квалификационная работа, 
\DocumentType{\large Выпускная квалификационная работа}

% Название дипломной работы
%\Title{\begin{Large}\bfseries Название дипломной работы\\ не помещающееся в одну строку\end{Large}}
\Title{\Large\bfseries Разработка стратегий для <<Игры в подстановки>>}

% Направление подготовки

% Руководитель
\Chief{Научный руководитель\\ к.\,ф.-м.\,н., доцент}{А.\,В.~Смирнов}

% Автор
\Author{Студент группы ИТ-41БО}{А.\,Н.~Гладков}

%\City{Ярославль}
%\Year{2017}


% Создаем титульный лист
\maketitle

	\chapter*{Реферат}

Объем \total{page} с., \total{chapternum} гл., \total{fignum} рис.,
\total{tablenum} табл., \total{bibnum} источников, \total{appnum} прил.

\medskip

\noindent
\textbf{Стратегия, сравнительный анализ, контекстно-свободная грамматика, теория игр, чистая стратегия, смешанная стратегия.}

\medskip

Объектом исследования является <<Игра в подстановки>>. Это антагонистическая игра с двумя участниками, основанная на~контекстно-свободной грамматике.

Целью работы является разработка эффективных стратегий для этой игры.

В процессе работы была разработана программа для моделирования <<Игры в подстановки>>, разработаны стратегии и графический интерфейс для запуска и просмотра партий, а также графический интерфейс для непосредственного участия в~игре.

 В~результате исследования был проведён сравнительный анализ разработанных чистых и смешанных стратегий и были выявлены наиболее эффективные стратегии.

% Содержание
\tableofcontents[Содержание]

% Пример ненумерованной главы
\chapternonum{Введение}

В работе рассматриваются стратегии для <<Игры в подстановки>>. В~этой игре дана  контекстно-свободная грамматика, продукции которой разбиты на 11 групп. Игроки кидают кубики, и по результатам броска определяется группа продукций, из~которой игроку предстоит выбрать одну продукцию, чтобы применить её к~имеющимся выводам. Целью игроков является получение слов как можно большей суммарной длины. 

Целью исследования является нахождение эффективных стратегий для этой игры.

\chapter{Постановка задачи}

Дана контекстно-свободная грамматика, разбитая на 11 групп продукций. Все продукции в~одной группе начинаются с~одного нетерминала, но при этом продукции из~разных групп могут начинаться одним нетерминалом. Например:

\begin{enumerate}
	\item $S \rightarrow ABC$
	\item $A \rightarrow aA \mid B$
	\item $A \rightarrow bc \mid CA$
	\item $A \rightarrow a$
	\item $S \rightarrow AB \mid AC$
	\item $B \rightarrow b$
	\item $B \rightarrow BBB$
	\item $C \rightarrow AA \mid c$
	\item $C \rightarrow A \mid B \mid c$
	\item $C \rightarrow T \mid A$
	\item $B \rightarrow abacabade$
\end{enumerate}

В~начале игры задаётся количество ходов $n$, которое может сделать каждый из~игроков. Имеется общий банк продукций и 2 шестигранных кубика.

Правила игры:
\begin{enumerate}
	\item Каждый игрок делает $n$ ходов. Ходы осуществляются по~очереди.
	\item Ход начинается с~броска обоих кубиков. Сумма чисел на~верхних гранях кубиков определяет группу продукций, из~которой игрок должен будет выбрать одну продукцию.
	\item Если это группа продукций, начинающаяся с~нетерминала $S$, то~можно либо создать новый вывод, либо использовать эту группу продукций для получения следующего шага вывода (если нетерминал $S$ присутствует в~каком-то текущем выводе). Количество начатых игроком выводов не~ограничивается.
	
	Если это группа продукций, начинающаяся другим нетерминалом, то если есть вывод с соответствующим нетерминалом, игрок обязан применить продукцию из выпавшей группы к~одному из~подходящих выводов, если же вывода с~соответствующим нетерминалом нет, группа продукций сохраняется в банке.
	\item Если после применения какой-то продукции в~выводах игрока присутствует нетерминал, для которого есть подходящая группа продукций в~банке, игрок обязан выбрать продукцию из~этой группы и применить эту продукцию к~одному из~подходящих выводов. Если в~банке находится несколько подходящих групп продукций, игрок выбирает любую из~них.
	\item Если на очередном шаге в текущем выводе или в нескольких выводах есть несколько подходящих нетерминалов, заменить можно любой на выбор игрока.
	\item Ход заканчивается, когда в банке нет ни одной продукции, подходящей для какого-либо текущего вывода игрока, либо когда выпавшая группа продукций не подходит ни для одного текущего вывода игрока.
\end{enumerate}

\textbf{Цель игры} --- получить как можно больше слов из терминальных символов как можно большей суммарной длины, то есть получить больше очков.

По окончании ходов всех игроков сентенциальные формы, содержащие нетерминалы, удаляются, а подсчёт очков идёт по правилу: 3 очка за каждое слово и по 1 очку за каждую букву.

Приведём пример хода для этой игры. Пусть имеется такое состояние банка (количество групп продукций в банке подписано справа от соответствующей группы в квадратных скобках):
\begin{enumerate}
	\item $S \rightarrow ABC [0]$
	\item $A \rightarrow aA \mid B [0]$
	\item $A \rightarrow bc \mid CA [2]$
	\item $A \rightarrow a [2]$
	\item $S \rightarrow AB \mid AC [0]$
	\item $B \rightarrow b [0]$
	\item $B \rightarrow BBB [0]$
	\item $C \rightarrow AA \mid c [1]$
	\item $C \rightarrow A \mid B \mid c [0]$
	\item $C \rightarrow T \mid A [0]$
	\item $B \rightarrow abacabade [1]$
\end{enumerate}

Пусть у игрока есть вывод: $AB$.  Выпали числа на кубиках 3 и 4. Сумма равна 7. Тогда можно получить вывод $ab$, применив выпавшую продукцию $B \rightarrow b$ и продукцию из группы под номером 4 $A \rightarrow a$. 

Также можно получить вывод $ccbb$, применив выпавшую продукцию $B \rightarrow b$, после этого продукцию $A \rightarrow CA$ из 3 группы, продукцию $C \rightarrow c$ из 8 группы, продукцию $A \rightarrow bc$ из 3 группы. Цепочка выводов: $AB \Rightarrow Ab \Rightarrow CAb \Rightarrow cAb \Rightarrow ccbb.$ 

Пусть на кубиках выпали числа 5 и 5. Сумма равна 10. В данном случае игрок не может совершить никакой ход, поскольку нет выводов, содержащих нетерминал $C$, даже при том, что в банке есть подходящие продукции, поэтому группа продукций 10 будет помещена в банк. 

\newpage
\chapter{Обзор родственных исследований}

Человеком придумано много различных игр, связанных с составлением слов. К~примеру, можно взглянуть на~игру \glqq Scrabble\grqq, или в~русском варианте <<Эрудит>>. Возьмём краткое изложение её правил с~сайта \cite{site1}. Игровое поле состоит из~$15\times15$, то есть~$225$ квадратов, на~которые участники игры выкладывают буквы, составляя тем самым слова. В начале игры каждый игрок получает~7 случайных букв (всего их в~игре~$100$). На~середину игрового поля выкладывается первое слово, затем следующий игрок может добавить слово из~своих букв. Слова выкладываются либо слева направо, либо сверху вниз.

Наша <<Игра в подстановки>> похожа на неё, с тем отличием, что в~<<Эрудите>> скорее не общий банк, а общие выводы --- общее игровое поле, и не частные выводы, а частный банк --- у каждого игрока свой набор букв.

Также есть игра \glqq Number Scrabble\grqq, взятая с~сайта~\cite{site2}, --- игра, где из имеющихся на руках карточек надо составлять правильные математические выражения. Для неё также есть разработанное приложение, чтобы можно было сыграть (см.~\cite{site3}). А математические выражение очень удобно задавать КС-грамматикой.

Есть диссертация \cite{Schuster:2017}, в~которой рассматривается близкая тема. В~этой диссертации исследуется целый класс контекстно-свободных игр. В~своей наиболее простой форме контекстно-свободные игры могут быть получены с~помощью небольшого смягчения проблемы выводимости слов в~контекстно-свободных грамматиках: дана контекстно-свободная грамматика~$G$ и сентенциальные формы~$w$ и~$w'$, возможно ли вывести~$w'$ из~$w$ в~соответствии с~правилами грамматики~$G$? 
 
В версии с двумя игроками первому игроку доступен выбор нетерминала, который необходимо заменить, а второй игрок выбирает какую последовательность символов, соответствующую правилам грамматики,  вставить. Вопрос состоит в том, имеет ли первый игрок выигрышную стратегию, если его задача получить определённую сентенциальную форму или одну из сентенциальных форм из определённого множества.

В работе рассматривается вопрос разрешимости а также проводится анализ сложности этой задачи при разных ограничениях и дополнительных условиях. 

\newpage
\chapter{Основные определения}
Возьмём определение грамматики из книги «Введение в теорию формальных языков» В.~А.~Соколова (см. \cite{litlink1}):

\begin{definition}
	Грамматикой $G$ называется следующая упорядоченная четвёрка объектов $G=(N,T,S,P)$, где 
	\begin{itemize}%[label=$\cdot$]
	\item$N$ --- конечное множество нетерминальных символов, называемых переменными (или нетерминалами);
	
	\item$T$ --- конечное множество терминальных символов, называемых терминалами;
	
	\item$S$ --- начальный символ, $S \in N$;
	
	\item$P$ --- конечное множество правил вывода, называемых продукциями.
	\end{itemize}
	Здесь и далее предполагается, что множества~$N$ и $T$ не~пусты и не~пересекаются. Каждая продукция $ p \in P $ имеет вид $\alpha \rightarrow \beta $, где $\alpha \in (N \cup T)^+$, $\beta \in (N \cup T)^* $.
\end{definition}

Если $\alpha \in (N \cup T)^*$, то любая последовательность вида $S \Rightarrow \alpha _1 \Rightarrow \alpha _2 \Rightarrow \alpha _3 \Rightarrow ... \Rightarrow \alpha _n \Rightarrow \alpha$ называется выводом строки~$\alpha$ в~грамматике~$G$; при этом если $\alpha \in T^*$, то~$\alpha$ называется сентенцией, а~$\alpha _i$ --- сентенциальной формой (в~грамматике~$G$).

Возьмём определение контекстно свободной грамматики из книги «Введение в теорию формальных языков» В.~А.~Соколова (см. \cite{litlink1}):
\begin{definition}
	Грамматика $ G=(N,T,S,P) $ называется контекстно-свободной (или КС-грамматикой), если любая ее продукция имеет вид $ A \rightarrow \alpha$, где $ A \in N $, $\alpha \in (N \cup T)^* $.
\end{definition}


Также там приводится определение бесполезных продукций: \textit{бесполезные продукции} --- те, которые никогда не~участвуют в~выводе никакой строки терминалов. 

На основе этого определим бесполезные нетерминалы и выводы: \textit{бесполезный нетерминал} --- нетерминал, с~которого начинаются только бесполезные продукции; \textit{бесполезный вывод} --- вывод, в~котором есть хоть один бесполезный нетерминал.

Также определим \textit{начальные продукции} --- те, с~помощью которых можно создавать новые выводы; это продукции вида $S \rightarrow \dots$.

Напомним определение динамической игры с~совершенной информацией из~книги А.~В.~Захарова <<Теория игр в~общественных науках>> (см.~\cite{litlink2}).

Для того чтобы описать \textit{динамическую игру}, нам нужно следующее. Во-первых, нам (как и в статической игре) нужно определить множество игроков. Для~того, чтобы моделировать случайные события, влияющие на~выигрыш игроков, нам необходимо ввести ещё одного игрока --- природу. Таким образом, мы имеем~$I=\{ 1,...,N\}\cup\{$ природа $\}$.

Во-вторых, нужно определить, в~каком порядке игроки ходят, и какие действия им доступны на~каждом ходе.

Наконец, в-третьих, нам надо определить, как выигрыши игроков зависят от~ходов, которые были сделаны. Формально в~каждой конечной вершине дерева игры мы определяем выигрыши для каждого игрока.

Каждому ходу, который игрок делает в~какой-то вершине, соответствует вершина, в~которой игра оказывается после сделанного хода. В~любом дереве игры для любой вершины, кроме начальной, однозначно задаётся \textit{история игры} --- последовательность вершин, через которые игра уже успела пройти. В~частности, для любой вершины (опять же, кроме начальной) существует ровно одна вершина, непосредственно предшествующая данной.

\begin{definition}
	Каждое информационное множество содержит одну или несколько вершин, в~которых принимает решения какой-то один игрок. Если несколько вершин находятся в одном информационном множестве, то игрок, принимающий решения в~этих вершинах, не знает, в~какой именно вершине он находится.
\end{definition} 

В~тех играх, в~которых игроки могут наблюдать за~предыдущими действиями всех других игроков, включая <<природу>>, каждое информационное множество содержит ровно одну вершину. 

\begin{definition}
	В~игре~$\Gamma$ в~развёрнутой форме множество чистых стратегий игрока~$i$ есть~$S_i = \prod_ {h_i \in H_i} A(h_i) $, где~$H _i$ содержит все информационные множества, в~которых делает ход игрок~$i$, а~$A(h_i)$ обозначает все действия, доступные игроку~$i$ в~информационном множестве~$h_i$.
\end{definition}

\begin{definition}
	Множеством смешанных стратегий игрока~$i$ будет $\Delta^{\mid\prod_{h_i\in H_i}A(h_i)\mid-1}$, где~$\Delta^n$ означает симплекс размерности~$n$.
\end{definition}

Совокупность дерева игры и информационных множеств игроков позволяет нам определить множество стратегий для каждого игрока.

\begin{definition}
	Пусть каждое информационное множество в~игре~$\Gamma$ содержит ровно одну вершину. Такая игра называется игрой с~совершенной информацией.
\end{definition}

Нашу «Игру в~подстановки» можно рассматривать как игру в~развёрнутой форме с~совершенной информацией с~тремя игроками: игрок~1, игрок~2 и природа или случайность (то, что выпало на~кубиках). Дерево игры будет выглядеть так: первым ход делает природа (бросок кубика первым игроком), далее ход переходит к~игроку~1, который совершает ход, соответствующий правилам игры, далее снова следует ход природы (бросок кубика вторым игроком), далее ход переходит игроку~2, который совершает ход, соответствующий правилам игры, далее снова ход совершает природа (бросок кубика первым игроком), и так~далее, пока игрок~1 и игрок~2 оба не~сделают указанное количество ходов.

Природа в~каждой вершине, где ей принадлежит ход, имеет~11 чистых стратегий (сумма на~кубиках от~2 до~12), но она всегда играет смешанную стратегию со~следующим распределением вероятностей:
\begin{table}[h!]
	\centering
	\caption{Распределение вероятности выпадения}
	\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|}
		\hline
		$x_i$ & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12\\
		\hline
		$p(x_i)$ & 1/36 & 2/36 & 3/36 & 4/36 & 5/36 & 6/36 & 5/36 & 4/36 & 3/36 & 2/36 & 1/36 \\
		\hline
	\end{tabular}
	\label{table1}\stepcounter{tablenum}
\end{table}

Здесь~$x_i$ --- сумма, выпавшая на кубиках, а~$p(x_i)$ --- шанс её выпадения.

Введём следующие обозначения:
$W_i$ --- множество выводов, имеющихся у~игрока $i$ в~данный момент.

Множество всех групп продукций обозначим~$P$, группу продукций под номером~$i$ обозначим~$P_i$, продукцию под номером~$j$ из группы продукций~$i$ обозначим~$P_{ij}$.

\begin{definition}
	Также определим множество~$A_{ij}$ --- множество выводов игрока~$i$, допустимое для группы продукций~$P_j$. Пусть группа продукций~$P_j$ имеет следующий вид:~$B~\rightarrow~... $, тогда $$A_{ij}=\{ w \mid w \in W_i \land w=\alpha B \beta, \forall \alpha , \beta \in (N \cup T)^* \lor w = S \land B=S\},$$ то есть это множество выводов, содержащих нетерминал левой части продукции, и символ~$S$, если в~левой части продукции стоит~$S$.
\end{definition}


\chapter{Описание стратегий}
\section{Случайная стратегия}

Задумка стратегии простая --- совершать случайный доступный ход. 
Данная стратегия делает все выборы с равными весами, но для более простого описания других стратегий опишем алгоритм получения случайного хода с произвольными весами.

\begin{weight}
	\label{weight1}
	Равные веса:$$\omega_1(\alpha) = 1,$$ где $\alpha$ --- группа продукций, продукция или слово.
\end{weight}

\begin{algoritm}
	\label{randomalgoritm}
	Алгоритм получения случайного хода.
	
	Определим вспомогательную функцию:
	
	\begin{center}
		\begin{math} 
			\varphi(r,(b_1,b_2,\dots,b_n)) = \begin{cases}
				1, & r\leqslant b_1,\\
				n, & r>\sum_{i=1}^nb_i,\\
				x : \sum_{i=1}^{x-1}b_i < r \leqslant \sum_{i=1}^{x}b_i, & \text{иначе}.
			\end{cases}
		\end{math}
	\end{center}
	
	\begin{enumerate}
		\item[0.] Пронумеруем все выводы игрока.
		\item \textbf{Совершение первого хода.} Пусть по~результатам броска кубиков выпала группа продукций под номером~$d$. Если множество $A_{pd}$, где~$p$ --- текущий игрок, пусто, то ход игрока заканчивается. Иначе переходим к~шагу~3.
		
		\item \textbf{Выбор группы продукций.} Зададим множество номеров допустимых групп продукций $I$ такое, что $j\in I \Longleftrightarrow$ $A_{pj} \neq \emptyset$ и группа продукций~$P_j$ содержится в банке. Если множество~$I$ пусто, то ход игрока заканчивается. Получим вектор $B = (\omega_1(P_{j}) \mid \forall j \in I )$.  Генерируем случайное число~$r_1\in\R$ с~равномерным распределением на~отрезке~$\left[0,\sum_{i=1}^{\mid B\mid}b_i\right]$. Находим число~$d=\varphi(r_1,B)$.
			
		\item \textbf{Выбор продукции из~группы продукций.} Пусть группа продукций~$P_d$ имеет следующий вид: $A~\rightarrow~\alpha_1|\dots|\alpha_n$. Получим вектор $C=(\omega_1(\alpha_i) \mid i\in\overline{1,n}).$ Генерируем случайное число~$r_2\in\R$ с~равномерным распределением на~отрезке $\left[0,\sum_{i=1}^{\mid C\mid}c_i\right]$. Находим число~$k=\varphi(r_2,C)$.
		
		\item \textbf{Выбор подходящего вывода.} Находим вектор~$D = (\omega_1(\alpha) \mid \forall \alpha\in A_{pd}).$ Генерируем случайное число $r_3\in\R$ c равномерным распределением на отрезке $\left[0,\sum_{i=1}^{\mid D\mid}d_i\right]$. Получаем число~$a=\varphi(r_3,D)$.
		
		\item \textbf{Завершение хода.} Применяем продукцию~$P_{dk}$ к выводу с~номером~$a.$ Переходим ко~2 шагу алгоритма.
	\end{enumerate}
\end{algoritm}

\section{Глупая стратегия коротких слов}

Идея стратегии в~том, чтобы за как можно меньшее число шагов получить сентенцию. 

Стратегия основана на анализе продукций грамматики. Для каждой продукции и группы продукций считается метрика того, насколько быстро её можно полностью привести к~сентенции. 

Ещё перед началом игры стратегия высчитывает метрику $M_{\ref{metric1}}$ для каждой группы продукции.

\begin{metric}[$M_{\ref{metric1}}$]
	\label{metric1}
	\
	\begin{enumerate}
		\item Метрика строки $\alpha$ равна количеству нетерминалов в этой строке.
		
		\item Метрика продукции $A \rightarrow \alpha$ равна метрике строки $\alpha$, то есть $$M_{\ref{metric1}}(A\rightarrow\alpha)=M_{\ref{metric1}}(\alpha).$$
		
		\item Метрика группы продукций $A \rightarrow \alpha_1\mid ... \mid \alpha_k$ равна минимуму метрик продукций $A\rightarrow \alpha_i, 1 \leqslant i \leqslant k$, то есть $$M_{\ref{metric1}}(A \rightarrow \alpha_1\mid...\mid\alpha_k)=\min_{1 \leqslant i \leqslant k}M_{\ref{metric1}}(A\rightarrow\alpha_i).$$
	\end{enumerate}
\end{metric}

Будем считать, что строка (продукция) $\alpha$ имеет лучшую метрику~\ref{metric1}, чем другая строка (продукция)~$\beta$, если $M_{\ref{metric1}}(\alpha)< M_{\ref{metric1}}(\beta)$.

Также перед началом игры для каждой группы продукций~$P_j$ находим продукцию~$k_j$ с лучшей  метрикой~\ref{metric1}.

\begin{algoritm}
	\label{algoritm2}
	\
	\begin{enumerate}
		\item Пусть по~результатам броска кубиков игроком $p$ выпала группа продукций~$P_d$. Если множество~$A_{pd}$ пусто, то ход заканчивается. Иначе находим метрику~$M_{\ref{metric1}}$ для каждого вывода~из~$A_{pd}$, и выбираем тот вывод, у~которого метрика~$M_{\ref{metric1}}$ наилучшая. Если это~$S$, то создаём новый вывод из правой части продукции~$k_d$. Иначе применяем к~выводу, соответствующему этому элементу продукцию~$k_d$.
		\item Выбираем группу продукций~$P_j$ с~наилучшей метрикой, для которой~$A_{pj}$ не~пусто и $P_j$~содержится в банке. Если таких групп продукций нет, то заканчиваем ход.
		\item Находим метрику~$M_{\ref{metric1}}$ для каждого вывода из~$A_{pj}$, выбираем вывод с~наилучшей метрикой~\ref{metric1} и применяем к~нему продукцию~$k_j$. Переходим к~шагу~2.
	\end{enumerate}
\end{algoritm}

Приведём пример, для упрощения возьмём грамматику с~четырьмя группами продукций:
\begin{enumerate}
	\item $S \rightarrow A [0]$
	\item $A \rightarrow BB \mid aA [2]$
	\item $B \rightarrow b [2]$
	\item $A \rightarrow a [1]$
\end{enumerate}

Вычисленная метрика для этих продукций: 
$$M_{\ref{metric1}}(S \rightarrow A)=1;$$ $$M_{\ref{metric1}}(A \rightarrow BB \mid aA)=\min\{M_{\ref{metric1}}(A \rightarrow BB),M_{\ref{metric1}}(A \rightarrow aA)\}=\min\{2,1\}=1;$$ $$M_{\ref{metric1}}(B \rightarrow b)=0;$$ $$M_{\ref{metric1}}(A \rightarrow a)=0.$$

Пусть у~игрока имеется вывод~$A$, и выпала группа продукций~2. Тогда будет совершён ход $A \Rightarrow aA \Rightarrow a$. В~выпавшей группе продукций будет выбрана продукция $A \rightarrow aA$. Далее будет выбрана продукция из~банка $A \rightarrow a$.  Заметим, что можно построить и сентенцию большей длины, но~целью алгоритма является за как можно меньшее число шагов получить сентенцию.

Также заметим, что если бы количество групп продукций $A \rightarrow a$ в~банке было равно~0 или имелась бы грамматика без этой группы продукций, то был бы совершён ход $A \Rightarrow aA \Rightarrow aaA \Rightarrow aaaA$. Таким образом, сентенция и вовсе~не была бы получена, хотя это возможно. Соответствующая цепочка выводов: $A\Rightarrow BB\Rightarrow bB\Rightarrow bb$. 

Именно из-за этого стратегия названа <<глупой>> --- её можно <<обмануть>>. К~примеру, добавить продукции, образующие цикл, или бесполезные продукции.

\section{Стратегия коротких слов}

Идея этой стратегии также состоит в~том, чтобы за~меньшее число шагов строить сентенцию.

Была разработана метрика, сконструированная так, чтобы избежать проблем, присущих метрике~\ref{metric1}, которые были кратко описаны выше.
\begin{metric}[$M_{\ref{metric2}}$]
	\label{metric2}
	Она строится итеративно:
	\begin{enumerate}
		\item Изначально метрика каждой продукции равна~$0$.
		
		\item Метрика группы продукций $A \rightarrow \alpha_1\mid ... \mid \alpha_k$ равна максимуму из~метрик продукций этой группы: $$M_{\ref{metric2}}(A \rightarrow \alpha_1\mid...\mid\alpha_k)=\max_{1 \leqslant i \leqslant k}M_{\ref{metric2}}(A\rightarrow\alpha_i).$$
		
		\item Метрика продукции пересчитывается следующим образом: метрика продукции~$A \rightarrow \alpha$ равна метрике строки~$\alpha$: $M_{\ref{metric2}}(A \rightarrow \alpha)=M_{\ref{metric2}}(\alpha)$. Здесь метрика строки равна произведению метрики каждого символа, содержащегося в~строке: $M_{\ref{metric2}}(\alpha)=\prod_{a \in \alpha}M_{\ref{metric2}}(a)$. Метрика терминала равна~1: $M_{\ref{metric2}}(a)=1, \forall a \in T$. Метрика нетерминала равна сумме произведений метрики соответствующей группы продукции и её вероятности выпадения: $$M_{\ref{metric2}}(A)=\sum M_{\ref{metric2}}(q)\cdot p(q)~\forall A \in N,$$ где $q$ --- группа продукций, вида $A \rightarrow ...$, $p(q)$ --- шанс выпадения группы продукций $q$.
		
		\item Переходим к шагу 2.
	\end{enumerate}
\end{metric}

Будем считать, что строка~(продукция)~$\alpha$ имеет лучшую метрику~\ref{metric2}, чем другая строка~(продукция)~$\beta$, если $M_{\ref{metric2}}(\alpha)> M_{\ref{metric2}}(\beta)$.

Заметим, что в~алгоритме не~указан момент остановки. 

\begin{statement}
	Метрика~\ref{metric2} каждой группы продукций при совершении итераций алгоритма сходится к~некоторому числу от~$0$~до~$1$.
\end{statement} 

Тогда можно задать необходимую точность~$\delta$, при достижении которой алгоритм будет останавливаться: $$\forall A: M_{\ref{metric2}}(A)\cdot\delta > |M_{\ref{metric2}}^*(A) - M_2(A)|,$$ где~$A$~---~продукция, $M_{\ref{metric2}}$ --- метрика, вычисленная на~предыдущей итерации, $M_{\ref{metric2}}^*$~---~метрика, вычисленная на~текущей итерации.

Для совершения хода используется Алгоритм~\ref{algoritm2} с использованием метрики~\ref{metric2}.

Приведём пример вычисленной метрики и пример хода, для упрощения возьмём грамматику~с~3 группами продукций:

\begin{enumerate}
	\item $S \rightarrow A [0]$
	\item $A \rightarrow BB \mid aA [1]$
	\item $B \rightarrow b [2]$
\end{enumerate}

Распределение вероятностей: $p(1)=\frac{1}{3}, p(2)=\frac{1}{3}, p(3)=\frac{1}{3}$.

Тогда результаты вычисления метрики~\ref{metric2} c~точностью $\delta = 0{,}05$ будут следующими: $$M_2(S \rightarrow A)=0{,}037037;$$ $$M_2(A \rightarrow BB)=0{,}111111;$$ $$M_2(A \rightarrow aA)=0{,}037037;$$ $$M_2(B \rightarrow b)=1.$$

Пусть у~игрока имеется вывод~$A$ и выпала продукция~2, тогда был бы совершён ход $A \Rightarrow BB \Rightarrow bB \Rightarrow bb$. В~выпавшей группе продукций будет выбрана продукция $A \rightarrow BB$, так~как у~неё больше метрика. Дальше будет применяться продукция $B \rightarrow b$. Заметим, что при~использовании метрики~\ref{metric1} на~этой грамматике и того~же алгоритма невозможно получить сентенцию. Продукция $A \rightarrow aA$ всегда будет считаться лучше, чем $A \rightarrow BB$, таким образом, нетерминал~A никогда~не заменится на~терминальный символ.

Теперь рассмотрим следующую грамматику: 
\begin{enumerate}
	\item $S \rightarrow A [0]$
	\item $A \rightarrow BB \mid aA [1]$
	\item $B \rightarrow b [2]$
	\item $A \rightarrow a [0]$
\end{enumerate}

Распределение вероятностей: $p(1)=\frac{1}{4}, p(2)=\frac{1}{4}, p(3)=\frac{1}{4}, p(4)=\frac{1}{4}$.

Значения метрики~\ref{metric2} будут следующими: $$M_2(S \rightarrow A)=0{,}333329;$$ $$M_2(A \rightarrow BB)=0{,}0625;$$ $$M_2(A \rightarrow aA)=0{,}333329;$$ $$M_2(B \rightarrow b)=1;$$ $$M_2(A \rightarrow a)=1.$$ 

Тогда будет совершён ход: $A \Rightarrow aA \Rightarrow aaA$. Заметим, что в~таком случае не~будет получена сентенция, хотя, как показано в~предыдущем примере, её можно получить. Отсюда и возникла идея следующей стратегии --- смотреть на несколько шагов вперёд.

\section{Переборная стратегия}
Идея этой стратегии в~том, чтобы перебрать разные варианты использования продукций из~банка, чтобы получить лучший вывод. Изначально планировалось собирать сразу терминальные строки, осуществляя полный перебор вариантов, но в~процессе разработки была обнаружена проблема: программа начинает работать слишком долго. Поэтому было принято решение ограничить глубину перебора, получилась не~одна стратегия, а целая группа стратегий с~параметром --- глубиной перебора. А~вместо поиска сентенции --- поиск вывода с~лучшей метрикой \ref{metric2}. Опишем алгоритм перебора продукций из~банка.

\begin{algoritm}[перебор ходов]
	\
	\label{searchalgoritm}
	
	\textbf{Вход:} вывод~$\alpha$, относительно которого производится перебор, число~$k$ --- глубина перебора.
	
	\textbf{Выход:} число~$f$ --- метрика лучшего получаемого вывода, ход~$m$, при котором получается вывод с~указанной метрикой.
	
	Алгоритм перебора задаётся рекурсивно:
	\begin{enumerate}
		\item Если~$k=0$, то~считаем метрику~\ref{metric2} вывода~$\alpha$ и заканчиваем алгоритм, возвращая пустой ход и вычисленную метрику.
		\item Найти множество номеров доступных групп продукций $Q$: $q \in Q \iff$ группа продукций~$P_q$ применима к рассматриваемому выводу~$\alpha$, и группа продукций~$P_q$ есть в~банке. Также задаём число~$b_f=0$ и ход~$b_m$ пустым.
		\item Если множество~$Q$ пусто, переходим к~шагу~6, иначе выбираем любой элемент $q$ из~множества~$Q$, удаляем группу продукций~$P_q$ из~банка.
		\item Перебираем~$i \in \overline{1,|P_q|}$. Получаем вывод~$\alpha'$, применяя продукцию~$P_{qi}$ к~текущему выводу~$\alpha$, запускаем алгоритм~\ref{searchalgoritm} с~параметрами~$\alpha'$ и $k-1$, получаем из~него число~$f$ и ход~$m$. Если~$f>b_f$, то~присваиваем~$b_f=f$, а~$b_m$ получаем, дополнив ход~$m$ информацией о~группе продукций~$P_q$ и продукции~$P_{qi}$, повторяем текущий шаг алгоритма, пока не~переберём все значения~$i$.
		\item Возвращаем~$P_q$ в~банк, удаляем~$q$ из множества~$Q$. Переходим к~шагу~3.
		\item Возвращаем число~$b_f$ и ход~$b_m$.
	\end{enumerate}
\end{algoritm}

Теперь представим алгоритм, определяющий поведение стратегии.

\begin{algoritm}
	\label{algoritm4}
	Алгоритм имеет параметр~$k$ --- глубину перебора. 
	\begin{enumerate}
		\item Пусть~$P_d$ --- выпавшая группа продукций по результатам броска кубиков игроком $p$. Если~$A_{pd}$ пусто, заканчиваем алгоритм.
		\item Найдём среди множества~$A_{pd}$ вывод~$\alpha$ с~наилучшей метрикой~\ref{metric2}. Инициализируем число~$b_f=0$ и пустой ход~$b_m$.
		\item Перебираем~$i \in \overline{1,|P_q|}$. Получаем вывод~$\alpha'$ применением продукции~$P_{di}$ к~выводу~$\alpha$. Запускаем алгоритм~\ref{searchalgoritm} для вывода~$\alpha'$ и глубины~$k$. Из него получим число~$f$ и ход~$m$. Если~$f>b_f$, то присваиваем~$b_f=f$, а~$b_m$ получаем, дополнив ход~$m$ информацией о~группе продукций~$P_d$ и продукции~$P_{di}$, повторяем текущий шаг алгоритма, пока не переберём все продукции в группе~$P_d$.
		\item Если~$\alpha = S$, создаём новый вывод~$S$ и применяем к~нему ход~$b_m$, иначе применим ход~$b_m$ к~выводу~$\alpha$. 
		\item Далее находим множество выводов~$A$, содержащее выводы игрока, к~которым можно применить какую-либо продукцию из~банка: $a \in A \iff \forall a \in W_p$ и $\exists i:$ группа продукций~$P_i$ применима~к~выводу~$a$ и $P_i$ есть в~банке. Если множество $A$ пусто, то ход игрока заканчивается. Найдём в~множестве~$A$ вывод~$\alpha$, имеющий наилучшую метрику~\ref{metric2}. Применим алгоритм~\ref{searchalgoritm} для~вывода~$\alpha$ и глубины~$k$, получим из~него ход~$m$. Если ход~$m$ не пуст, то применим ход~$m$ к~выводу~$\alpha$ и повторим этот шаг алгоритма, иначе завершаем ход.
	\end{enumerate}
\end{algoritm}

Отметим, что для применения алгоритма надо вычислить метрику~\ref{metric2} для имеющихся групп продукций.

Приведём пример на основе данной грамматики:
\begin{enumerate}
	\item $S \rightarrow A [0]$
	\item $A \rightarrow BB \mid aA [1]$
	\item $B \rightarrow b [2]$
	\item $A \rightarrow a [0]$
\end{enumerate}

Распределение вероятностей: $p(1)=\frac{1}{4}, p(2)=\frac{1}{4}, p(3)=\frac{1}{4}, p(4)=\frac{1}{4}$.

Метрики будут следующими: $$M_2(S \rightarrow A)=0{,}333329;$$ $$M_2(A \rightarrow BB)=0{,}0625;$$ $$M_2(A \rightarrow aA)=0{,}333329;$$ $$M_2(B \rightarrow b)=1;$$ $$M_2(A \rightarrow a)=1.$$ 

Пусть выпала продукция $S \rightarrow A$. Тогда при~глубине перебора $4$ будет совершён ход: $S \Rightarrow A \Rightarrow BB \Rightarrow bB \Rightarrow bb$.

\section{Умная случайная стратегия}
Идея заключается в~модификации случайной стратегии с~помощью изменения весов выбираемых вариантов. В~качестве первого способа нахождения этих весов возьмём метрику~\ref{metric2}.
Она обладает хорошими свойствами: её значение для~выводов, которые нельзя преобразовать в~терминальные, и бесполезных продукций равно нулю; её значения меньше для слов, которые можно за меньшее количество ходов привести к~сентенции, следовательно, стратегия не будет строить излишне длинные выводы.

\begin{weight}
	\label{weight2}
	Веса в~соответствии с~метрикой~\ref{metric2}:
	
	$$\omega_2(\alpha) = M_{\ref{metric2}}(\alpha),$$ где $\alpha$ --- группа продукций, продукция или слово.
\end{weight}

Стратегия показывает результаты схожие со~стратегией коротких слов. Часто она ведёт себя как стратегия коротких слов. Ниже объяснено, почему это происходит.

\section{Проблемы метрики \ref{metric2} и создание новой}
В ходе более глубокого анализа метрики \ref{metric2} был обнаружен большой недостаток. Из-за того, как она устроена, она очень быстро стремится к нулю при увеличении количества нетерминалов в правой части продукции. Хоть и для нахождения лучшей продукции она вполне применима, то для использования в качестве весов для случайной стратегии, она плохо подходит.

Для примера возьмём грамматику меньшего масштаба, будто~бы в~игре используется~2 кубика с~тремя гранями:
\begin{enumerate}
	\item $S \rightarrow AA|DD$
	\item $A \rightarrow BB$
	\item $D \rightarrow ee$
	\item $C \rightarrow DD$
	\item $B \rightarrow CC$
\end{enumerate}

Тогда получатся следующие значения метрики: 
$$M_2(S \rightarrow AA)\approx1{,}03988\cdot10^{-18};$$ $$M_2(S \rightarrow DD)\approx0{,}11111.$$ 

Разница составляет много порядков, тогда при выборе между соответствующими продукциями можно с большой долей вероятности сказать, что всегда будет выбрана вторая продукция. Таким образом, умная случайная стратегия во~многих случаях ведёт себя как стратегия коротких слов.

Идея новой метрики заключается в изменении правила получения метрики слова: она равна минимальной метрике нетерминала, встречающегося в слове, делённой на общее количество нетерминалов в слове. Опишем это формально:
\begin{metric}[$M_3$]
	\label{metric3}
	Она строится итеративно:
	\begin{enumerate}
		\item Изначально метрика каждой продукции равна $0$.
		\item Метрика группы продукций $A \rightarrow \alpha_1\mid ... \mid \alpha_k$ равна максимуму из метрик продукций этой группы: $$M_3(A \rightarrow \alpha_1\mid...\mid\alpha_k)=\max_{1 \leqslant i \leqslant k}M_3(A\rightarrow\alpha_i).$$
		\item Метрика продукции пересчитывается следующим образом: метрика продукции $A \rightarrow \alpha$ равна метрике строки $\alpha$: $M_3(A \rightarrow \alpha)=M_3(\alpha)$. Здесь метрика строки равна минимуму метрики нетерминала, встречающегося в строке, делённому на количество всех нетерминалов в строке~$\alpha$: $$M_3(\alpha)=\min_{a \in \alpha \wedge a \in N}M_3(a) \div count(a \in \alpha \wedge a \in N).$$
		Метрика терминала равна 1: $M_3(a)=1~\forall a \in T$. Метрика нетерминала равна сумме произведений метрики соответствующей группы продукции и вероятности выпадения этой продукции: $$M_3(A)=\sum M_3(q)\cdot p(q) \forall A \in N,$$ где $q$ --- группа продукций вида $A \rightarrow ...$, $p(q)$ --- шанс выпадения группы продукций $q$.
		\item Переходим к шагу 2.
	\end{enumerate}
\end{metric}

Тогда получатся следующие значения метрики: 
$$M_3(S \rightarrow AA)\approx0{,}00011;$$ $$M_3(S \rightarrow DD)\approx0{,}16666.$$

Видно, что масштаб уже совершенно другой, но это всё ещё слишком большая разница. Поэтому дополнительно имеет смысл рассмотреть разные варианты преобразований этих весов. К~примеру, извлечь из них квадратный корень. До~преобразования разница составляла $8748$ раз, то после преобразования разница составит $\approx93{,}53$ раз. 

\section{Улучшенная умная случайная стратегия}
Стратегия основана на формировании весов с использованием метрики~\ref{metric3} с~последующим извлечением корня.

\begin{weight}
	\label{weight3}
	Веса в~соответствии с~метрикой~\ref{metric3} с~последующим извлечением корня:
	
	$$\omega_3(\alpha) = \sqrt{M_{\ref{metric3}}(\alpha)},$$ где $\alpha$ --- группа продукций, продукция или слово.
\end{weight}

Стратегия ведёт себя лучше умной случайной стратегии, но всё так же проигрывает переборной стратегии.

\section{Адаптивная случайная стратегия}
Перечисленные ранее стратегии всё так же стремятся создавать короткие выводы. Следующая~же стратегия предназначена для построения более длинных выводов.

Поведение стратегии делится на~2~этапа. На~первом этапе будут применяться продукции, не ведущие к~уменьшению количества нетерминалов. На втором этапе будут совершаться ходы, ведущие к~наискорейшему окончанию всех выводов.

Отметим, что адаптивная случайная стратегия также является представителем класса смешанных стратегий, но с~другим правилом смешения, основанном не на~вероятностном выборе, а на~оценке текущего положения в~игре. 

На~втором этапе мы рассмотрим применение переборной стратегии и стратегии коротких слов и сравним их эффективность. Для первого этапа требуется разработка новой стратегии. Определим \textbf{инвертированную случайную стратегию}, задав веса для~случайного выбора.

\begin{weight}
	\label{weight4}
	Инвертированные веса:
	
	\begin{math}
		\omega_4(\alpha) = \begin{cases} 0, & \text{если } M_{\ref{metric3}}(\alpha)=0,\\
			1{,}01 - M_{\ref{metric3}}(\alpha), & \text{иначе},
		\end{cases}
	\end{math}
	
	
	\noindent где $\alpha$ --- группа продукций, продукция или слово.
\end{weight}

В~формирование весов включён отдельный случай при~метрике равной нулю, чтобы бесполезные продукции имели минимальный приоритет. В другом случае вес формируется вычитанием метрики из~$1{,}01$, отступ на~$0{,}01$ от~$1$ сделан для того, чтобы в~случае когда на~выбор имеется только продукция с~метрикой равной~$1$ и бесполезная продукция, предпочтение отдавалось первой.

Отметим, что инвертированная случайная стратегия не является самостоятельной, так как она почти никогда не будет получать законченные выводы.

Вернёмся к адаптивной случайной стратегии. Важным вопросом является момент перехода от первого этапа ко~второму. Переход будет совершаться при~выполнении следующего условия: $$\{\text{чиcло нетерминалов во всех выводах игрока}\} \cdot \Omega > \{\text{число оставшихся ходов}\}.$$ Стратегия получается довольно сильно зависимой от~параметра $\Omega$; если его взять слишком большим, то стратегия станет очень похожей на~переборную стратегию, иначе же, если его взять слишком маленьким, то у стратегии не будут получаться законченные выводы. Вопрос нахождения оптимального значения параметра $\Omega$ будет рассмотрен в главе \ref{chap:analysis}.

\section{Смешанные стратегии}
Идея заключается в выборе на каждом шаге одной из~чистых стратегий с какой-то вероятностью. Основываться смешанные стратегии будут не на всех чистых стратегиях, а лишь на четырёх: стратегии коротких слов, улучшенной умной случайной стратегии, переборной стратегии и адаптивной случайной стратегии. 

Для формирования смешанных стратегий, как в работе~\cite{Kruglikov2024},  введём термин \textit{очки вероятности}. \textit{Очки вероятности} — это числа, сопоставляемые каждой чистой стратегии в соответствии с~одним из~вариантов распределения и характеризующие вероятность каждой чистой стратегии внутри смешанной. Вероятность чистой стратегии внутри смешанной равняется её очкам вероятности, делённым на~сумму всех очков вероятности.

Для распределения очков вероятности было выбрано несколько вариантов распределения:
\begin{enumerate}
	\item Самый простой вариант из~них --- <<Равные вероятности>>, в котором каждая чистая стратегия внутри смешанной получает по~одному очку вероятности.
	\item Контрастирующий с~предыдущим вариантом вариант <<Пики>>, при котором более выгодные стратегии получают намного больше очков вероятности, чем остальные.
	\item Вариант <<Линейный рост>>, при таком варианте все очки вероятности различны и отличаются на~$1$; чем выгоднее стратегия, тем больше очков вероятности она получает.
	\item Вариант <<Процент~от~побед>>, в~нём каждая чистая стратегия получает число очков вероятности равное отношению суммы её побед к сумме всех побед чистых стратегий, это~определяется на~основе статистики вычислительных экспериментов.
\end{enumerate}  

\newpage
\chapter{Программная реализация}
\section{Описание реализации используемых стратегиями классов}

Рассмотрим программную реализацию стратегий и использованные для этого классы. Для написания программы был выбран язык~C\#, выбран он был за~то, что он предоставляет удобные средства для разработки оконных приложений и имеет большой спектр возможностей, а также заранее скомпилированная программа будет работать почти на~любом компьютере с~ОС~Windows.

{\sloppy{}Первым мы рассмотрим класс \texttt{GameSettings} --- этот класс хранит данные о~конфигурации текущей партии. Класс является неизменяемым, его поля открыты только для~чтения. Поле \texttt{NumberOfMoves} задает количество ходов, которое должен сделать каждый из~игроков. Список \texttt{productions} объектов класса \texttt{ProductionGroup} хранит грамматику, задаваемую набором из~11 групп продукций, поле является закрытым, чтобы избежать его изменения. Получение доступа к~полю осуществляется с~помощью метода \texttt{GetProductions()}. Также есть свойство \texttt{ProductionsCount}, возвращающее количество групп продукций, в~нашем случае значение всегда~11. Поле \texttt{RandomSettings}, являющееся экземпляром класса \texttt{RandomSettings}, задаёт распределение вероятностей выпадения групп продукций, в~нашем случае оно всегда установлено соответственно таблице~\ref{table1}. Также имеются методы для~записи конфигурации в~формате .xml в~файл и в~поток --- методы \texttt{WriteToFile()} и \texttt{WriteToStream()} соответственно. Также имеются и методы для считывания конфигурации в~формате .xml из~файла и из~потока --- методы \texttt{ReadFromFile()} и \texttt{ReadFromStream()} соответственно. 

Теперь рассмотрим ранее упомянутый класс \texttt{RandomSettings}, который, как уже было сказано, задаёт распределение вероятностей выпадения продукций. Этот класс также является неизменяемым, в~нашем случае он всегда задаёт распределение вероятностей, как в~таблице~\ref{table1}. Вероятность хранится в~виде обычной дроби: \texttt{totalPossibility} --- знаменатель, доступ к~которому предоставляется с~помощью метода \texttt{getTotalPossibility()}, и список \texttt{possibilityList} --- числитель для каждой группы продукций, доступ к~которому предоставляется с~помощью метода \texttt{getProductionPossibility()}.

Рассмотрим класс \texttt{ProductionGroup}. Этот класс задаёт группу продукций и является неизменяемым. Поле \texttt{Left} хранит нетерминал, находящийся в~левой части продукций, а список \texttt{right} хранит строки, являющиеся правыми частями продукций, доступ к~которому предоставляется с~помощью методов \texttt{getRightAt()} и \texttt{getRights()}, а свойство \texttt{RightSize} возвращает количество продукций в~группе. Есть возможность записать класс в~строковом формате и считать его из~строки, за~это отвечают методы \texttt{ToString()} и \texttt{fromString()} соответственно.

Класс \texttt{Bank} описывает банк продукций. Список \texttt{productionsBank} хранит количество каждой продукции, доступ осуществляется с помощью методов: \texttt{addProduction()} --- для добавления группы продукций в~банк, \texttt{removeProduction()} --- для~удаления группы продукций из~банка, метод \texttt{getProductionCount()} возвращает количество групп продукций указанного типа в~банке, метод \texttt{getProductions()} возвращает количество всех групп продукций в~данке.

Рассмотрим классы \texttt{Move} и \texttt{PrimaryMove} --- ход и простейший ход. \texttt{PrimaryMove} является неизменяемым классом и имеет~3 поля, доступных для~чтения: \texttt{WordNumber} --- номер вывода игрока, \texttt{ProductionGroupNumber} --- номер группы продукции и \texttt{ProductionNumber} --- номер продукции в группе. \texttt{Move} хранит список \texttt{moves} объектов класса \texttt{PrimaryMove}, предоставляет методы: \texttt{addMove()} --- для добавления нового простейшего хода, \texttt{popMove()} --- для~удаления по правилам стека, и \texttt{getMoves()} --- для~чтения. Также реализует запись в~строковый формат и чтение из~строкового формата --- методы \texttt{ToString()} и \texttt{FromString()}, с их~помощью программы стратегий передают полученный ход.

Также перед рассмотрением кода стратегий рассмотрим класс \texttt{StrategyUtilitiesClass}, этот~класс является статическим. Он предоставляет методы, которые являются общими для~разных стратегий. Метод \texttt{isHaveLetter()} --- возвращает индекс первого вхождения символа в~выводе или~$-1$, если символ не~найден. Метод \texttt{findMatches()} реализует поиск множества~$A_{ij}$ слов, допускаемых продукцией, с~тем лишь отличием, что тут нет элемента, соответствующего созданию нового слова. Также там присутствуют методы для~применения ходов к~списку имеющихся слов. В~класс добавлены методы для вычисления всех трёх определённых нами метрик.  

Также взглянем на~классы \texttt{SimplifiedWord} и \texttt{SimplifiedProductionGroup}. Это упрощённый вывод и упрощённая группа продукций. Упрощение заключается в~том, что от~строкового представления мы переходим к~представлению, где хранится количество терминалов и количество каждого нетерминала. Возникает это упрощение с~целью оптимизации работы программы, поскольку работа со~строками слишком трудоёмкая. Для~определения вхождения символа в~строку необходимо просмотреть её всю.

В~классе \texttt{SimplifiedWord} есть поле \texttt{terminals}, соответствующее количеству терминалов, и массив \texttt{nonterminals}, соответствующий количеству нетерминалов. В~нём также есть методы, предназначенные для удобного доступа к полям класса. Класс \texttt{SimplifiedProductionGroup} имеет поле \texttt{Left}, которое, как и в~классе \texttt{ProductionGroup}, отвечает за~нетерминал, находящийся в~левой части продукций. Также он имеет список \texttt{rights} объектов класса \texttt{SimplifiedWord} --- правые части продукций в~упрощённом виде. За~конвертацию из~обычного вида в~упрощённый отвечает класс \texttt{Simplifier}, который по~введённой грамматике строит прямое и обратное отображение из~нетерминальных символов в~целые числа, чтобы хранить количество нетерминалов в~словах в~виде массива.}

\section{Описание реализации стратегий}

{\sloppy{}Каждая из~стратегий является наследником абстрактного класса \texttt{Strategy}. Он предоставляет интерфейс для~взаимодействия со~стратегиями. Для~оптимизации классы сделаны так, что один экземпляр класса можно использовать одновременно в~нескольких партиях с~одинаковыми правилами. Каждый ход делается независимо, классы не хранят никакие данные связанные с~конкретной партией. Класс содержит~2 основных метода: метод \texttt{makeMove}, который надо реализовать, чтобы написать новую стратегию; метод \texttt{setGameSettings()}, который позволяет поменять правила игры. Также есть событие \texttt{GameSettingsChanged}, на~которое можно добавить обработчик при~необходимости проведения дополнительных действий при~изменении правил игры.

Начнём со~\textbf{случайной стратегии}. Она представлена классом \texttt{RandomStrategy}. В нём есть~5 интересующих нас методов: метод \texttt{findFirstMove()} отвечает за~нахождение применения для~выпавшей продукции, то~есть выполнение шагов~1, 3, 4 и 5 алгоритма~\ref{randomalgoritm}; метод \texttt{findMove()} отвечает за~шаги~2, 3, 4 и 5 алгоритма~\ref{randomalgoritm}, то~есть за~нахождение применения для продукций из банка; методы \texttt{getGroupsWeights}, \texttt{getProductionsWeights}, \texttt{getWordsWeights} отвечают за~нахождение весов для~случайного выбора. По~умолчанию всему присваиваются веса равные единице. Именно эти~методы будут переопределяться, чтобы получать разные вариации случайной стратегии.

Реализация \textbf{умной случайной стратегии}, её \textbf{улучшенной} и \textbf{инвертированной} версии реализовано переопределением упомянутых выше методов.

Теперь рассмотрим \textbf{глупую стратегию коротких слов}. Она представлена классом \texttt{StupidShortWordsStrategy}. Перед началом ходов для~продукций вычисляется метрика~\ref{metric1}, а также для~каждой группы продукций находится лучшая продукция.  Метод \texttt{findFirstMove()} отвечает за~шаг~1 алгоритма. Метод \texttt{findMove()} отвечает за шаги~2 и 3 алгоритма.

Теперь рассмотрим \textbf{стратегию коротких слов}. Она представлена классом \texttt{ShortWordsStrategy}. Её реализация отличается от~предыдущей лишь тем, что вычисляется метрика~\ref{metric2}.

Теперь рассмотрим \textbf{переборную стратегию}. Она представлена классом \texttt{SearchStrategy}. При создании экземпляра класса можно передать параметр, определяющий глубину перебора. Метод \texttt{searchMove} реализует алгоритм \ref{searchalgoritm}.  Метод \texttt{findFirstMove} реализует шаги 1---4 алгоритма \ref{algoritm4}, то есть нахождение лучшего хода для~выпавшей продукции. Метод \texttt{findMove} реализует шаг 5 этого алгоритма.

\textbf{Смешанная стратегия} представлена классом \texttt{MixedStrategy}, а \textbf{адаптивная случайная стратегия} представлена классом \texttt{AdaptiveRandom}. Реализация этих стратегий заключается в создании экземпляров других стратегий и передачи хода им.

Рассмотренный выше код представлен в приложении~\ref{code}.}

\section{Описание интерфейса}

\begin{figure*}[ht!]
	\begin{minipage}{0.49\linewidth}
		\includegraphics[width=\textwidth]{main_window.png}
		\caption{Скриншот основного окна}
		\label{main_window}\stepcounter{fignum}
	\end{minipage}
	\hfill
	\begin{minipage}{0.49\linewidth}
		\includegraphics[width=\textwidth]{main_window_tournament.png}
		\caption{Скриншот основного окна. Выбрана опция турнир}
		\label{tournament_window}\stepcounter{fignum}
	\end{minipage}
\end{figure*}


Перед запуском игры надо выбрать грамматику, это можно сделать нажав на~кнопку \textbf{<<Выбрать>>} в~верхнем правом углу окна. После нажатия на неё появится окно, скриншот которого можно увидеть на~рис.~\ref{interface2}. В~левой части окна выбора грамматики, представленном на~рис.~\ref{interface2},  можно увидеть уже имеющиеся в~программе грамматики, а в~правой части можно увидеть саму грамматику. Также можно создать свою грамматику, это делается нажатием на~кнопку~\textbf{<<Создать>>} в~левой нижней части окна, после нажатия на~которую откроется окно, представленное на~рис.~\ref{interface3}. Для выбора грамматики надо нажать на~кнопку \textbf{<<Выбрать>>} в~правой нижней части окна. 

\begin{figure*}[hb!]
	\begin{minipage}{0.49\linewidth}
		\includegraphics[width=\textwidth]{grammatic_select.png}
		\caption{Скриншот окна выбора грамматики}
		\label{interface2}\stepcounter{fignum}
	\end{minipage}
	\hfill
	\begin{minipage}{0.49\linewidth}
		\includegraphics[width=\textwidth]{grammatic_creation.png}
		\caption{Скриншот окна создания грамматики}
		\label{interface3}
	\end{minipage}\stepcounter{fignum}
\end{figure*}

В окне создания грамматики, представленном на~рис.~\ref{interface3}, в~левой части есть поле для ввода грамматики, вводить её следует так: каждая группа продукций в~отдельной строке, то есть разделитель --- перенос строки. Каждая группа продукций записывается так: нетерминал, стрелка~(\mbox{->}) и продукции, разделённые вертикальной чертой. Пример можно увидеть на~рис.~\ref{interface3}. После завершения ввода надо нажать кнопку \textbf{<<Сохранить>>} в~правой нижней части экрана.

Также перед запуском игры необходимо указать то, сколько ходов делают игроки, для~этого нужно в~основном окне, представленном на~рис.~\ref{main_window}, ввести это число в~поле напротив метки \textbf{<<К-во ходов>>}. 

В~программе есть~2 варианта запуска игры: турнир и одна партия. При запуске одной партии есть возможность в~качестве игрока выбрать графический интерфейс и самим сыграть в~игру против какой-либо стратегии. Режим запуска одной партии активен, когда галочка у~опции \textbf{<<Турнир>>} не стоит, это можно увидеть на~рис.~\ref{main_window}. 

Далее перед запуском партии необходимо выбрать игроков. Для этого надо кликнуть на элемент находящийся рядом с~надписью \textbf{<<Игрок [номер]:>>}, появится выпадающее меню с вариантами на выбор, это меню можно увидеть на~рис.~\ref{tournament_window}.

Если же надо запустить турнир, то галочку у~опции \textbf{<<Турнир>>} надо поставить. Для турнира необходимо указать, сколько партий будет сыграно каждой парой игроков, для этого нужно ввести это число в~поле, рядом с~меткой \textbf{<<К-во партий>>}.  Далее надо выбрать игроков, для этого их сначала надо добавить, это делается нажатием на кнопку \textbf{<<Добавить игрока>>}, после этого надо выбрать игрока, делается это так же, как было описано выше. Перечисленное можно увидеть на~рис.~\ref{tournament_window}.


Для стратегий, у которых есть какой-либо параметр, есть возможность его указать, это производится в отдельном окне, которое можно увидеть на~рис.~\ref{pic:parameters}.  Открывается окно кликом по~кнопке \textbf{<<Настроить>>}, эту кнопку можно увидеть на~рис.~\ref{main_window} и рис.~\ref{tournament_window}.

\begin{figure}[h]
	\begin{minipage}{0.59\linewidth}
		\centering
		\includegraphics[width=\textwidth]{view_game.png}
		\caption{Скриншот окна просмотра партии}
		\label{interface6}\stepcounter{fignum}
	\end{minipage}
	\hfill
	\begin{minipage}{0.39\linewidth}
		\includegraphics[width=\textwidth]{parameters.png}
		\caption{Скриншот окна параметров}
		\label{pic:parameters}\stepcounter{fignum}
	\end{minipage}
\end{figure}

Для запуска игры надо нажать на кнопку \textbf{<<Начать>>}. Если был выбран турнир, то начнётся разыгрывание партий между игроками, внизу окна будет отображаться шкала прогресса. После завершения всех партий откроется новое окно с~таблицей результатов, его можно увидеть на~рис.~\ref{interface5}. Просмотреть ход конкретной партии турнира можно, выбрав её в правой части и нажав на кнопку \textbf{<<Просмотр партии>>}, после нажатия на~неё откроется окно которое можно увидеть на~рис.~\ref{interface6}.

\begin{figure}[t]
	\centering
	\includegraphics[width=\textwidth]{results_window.png}
	\caption{Скриншот окна результатов турнира}
	\label{interface5}\stepcounter{fignum}
\end{figure}



Если же игра была запущена, и была выбрана одна партия, то сразу откроется окно просмотра партии. В окне просмотра партии есть кнопки \textbf{<<Назад>>}, \textbf{<<Вперёд>>}, \textbf{<<В начало>>} и \textbf{<<До конца>>} для проматывания ходов. В окне отображается вся информация об игре.

\begin{figure}[!b]
	\centering
	\includegraphics[width=0.91\textwidth]{gui_strategy.png}
	\caption{Скриншот окна ввода хода через графический интерфейс}
	\label{interface7}\stepcounter{fignum}
\end{figure}

Если выбрать в качестве игрока графический интерфейс, то для ввода хода откроется окно, которое можно увидеть на рис. \ref{interface7}. В правой верхней части окна можно увидеть основные параметры партии, также в верхней части окна можно увидеть имеющиеся выводы обоих игроков. В средней части окна слева находится банк продукций, в середине отображается текущий ход, а справа кнопки для управления. В нижней части окна можно увидеть элементы для добавления хода. Для добавления хода нужно в банке продукций выбрать желаемую группу продукций, далее в нижней левой части выбрать продукцию из группы продукций и в нижней правой части выбрать слов, к которому надо применить продукцию, после этого нажать на кнопку \textbf{<<Добавить ход>>}.


\newpage

\chapter{Сравнительный анализ стратегий}
\label{chap:analysis}
Теперь проведём сравнительный анализ стратегий. Имеет смысл рассматривать поведение стратегий на~грамматиках разного вида. Для этого можно выделить некоторые классы грамматик. К~примеру, можно делить по~частоте выпадения начальных продукций~(позволяющих начинать новые выводы). Поскольку большинство стратегий так или иначе конструировались таким образом, чтобы как можно быстрее получать сентенции, то~при малой частоте выпадения начальных продукций эти стратегии будут получать малое количество очков. 

Также можно выделить грамматики, имеющие бесполезные продукции, на~них случайная стратегия будет работать плохо, а, при~определённых условиях, и глупая стратегия коротких слов. Отдельно мы такие грамматики рассматривать не~будем, так~как плохая работа упомянутых стратегий на~таких грамматиках очевидна, а эффективность других стратегий будет сильнее зависеть от~частоты выпадения начальных продукций.

В качестве грамматики со~средним шансом выпадения начальных продукций возьмём грамматику из~постановки задачи. В~качестве грамматики с~низким шансом выпадения начальных продукций возьмём ту же грамматику но немного её изменим: заменим нетерминал в~левой части пятой группы продукций с~$S$ на~$A$. 

Проведение турнира с~использованием грамматики с~высоким шансом выпадения начальных продукций не является интересным. Поскольку большинство стратегий строилось для построения коротких выводов, то результаты будут примерно одинаковыми, а наилучшей будет переборная стратегия. Задача построения выводов кратчайшим способом во~многом уже решена и не является интересной. Намного более интересной задачей является построение более длинных выводов.

Для сравнения стратегий будет проводиться круговой турнир из~500 партий с~200 шагов в~каждой. Результаты кругового турнира с~использованием грамматики из~постановки задачи между всеми стратегиями можно увидеть в~таблице~\ref{table:highfreq}. В первом столбце указаны стратегии игрока, ходившего первым, а в первой строке --- вторым. В ячейках до перовой наклонной черты указано количество побед первого игрока, после --- второго, а после второй наклонной черты указано количество ничьих.

\begin{table}[h!]
	\small
	\centering
	\setlength\tabcolsep{1.6pt}
	\caption{Распределение побед в турнире с использованием грамматики с средним шансом выпадения начальных продукций}
	\label{table:highfreq}\stepcounter{tablenum}
	\centering
	\begin{tabular}{| c | c | c | c | c | c | c | c | c |}
		\hline
		      & СС        & УСС       & УУСС      & ГСКС      & СКС       & ПС1       & ПС4       & AAC10     \\ \hline
		СС    & 238/256/6 & 36/464/0  & 35/461/4  & 64/432/4  & 50/449/1  & 28/471/1  & 12/488/0  & 14/485/1  \\ \hline
		УСС   & 461/37/2  & 258/240/2 & 243/250/7 & 313/180/7 & 374/125/1 & 167/330/3 & 91/407/2  & 105/390/5 \\ \hline
		УУСС  & 453/46/1  & 229/267/4 & 253/243/4 & 282/215/3 & 342/154/4 & 163/332/5 & 109/389/2 & 105/390/5 \\ \hline
		ГСКС  & 430/69/1  & 180/319/1 & 207/290/3 & 259/238/3 & 262/234/4 & 136/357/7 & 83/415/2  & 72/426/2  \\ \hline
		СКС   & 454/45/1  & 102/396/2 & 168/328/4 & 227/271/2 & 241/251/8 & 62/436/2  & 38/462/0  & 149/347/4 \\ \hline
		ПС1   & 479/21/0  & 343/156/1 & 321/176/3 & 362/134/4 & 431/68/1  & 251/243/6 & 149/349/2 & 160/336/4 \\ \hline
		ПС4   & 486/14/0  & 415/85/0  & 403/95/2  & 427/72/1  & 463/36/1  & 332/166/2 & 273/223/4 & 247/246/7 \\ \hline
		AAC10 & 485/14/1  & 374/125/1 & 390/106/4 & 423/75/2  & 358/140/2 & 312/185/3 & 252/246/2 & 256/241/3 \\ \hline
	\end{tabular}
\end{table}

В таблице применены сокращения названий стратегий до~первых букв слов в~названии, а число, идущее после, соответствует значению параметра. Перечислим используемые сокращения: СС --- случайная стратегия, УСС --- умная случайная стратегия, УУСС~---~улучшенная умная случайная стратегия, ГСКС~---~глупая стратегия коротких слов, СКС~---~стратегия коротких слов, ПС~---~переборная стратегия, АСС~---~адаптивная случайная стратегия. Сейчас рассмотрим результаты всех стратегий, исключая адаптивную случайную стратегию.

Случайная стратегия показывает себя плохо в~сравнении со~всеми остальными стратегиями. Её улучшенные варианты показывают себя значительно лучше, но всё так~же проигрывают переборной стратегии.

Глупая стратегия коротких слов неожиданно показывает себя лучше стратегии коротких слов. Это вызвано тем, что при равенстве метрик, то есть при равенстве количества нетерминалов в~продукциях, она считает лучшей ту, где больше терминальных символов, так она набирает больше очков. Также, как было сказано в описании стратегии, метрика не выполняет свою изначальную задумку и не позволяет строить кратчайшие выводы. Но стоит отметить, что в~грамматику легко добавить ловушку для данной стратегии, которая совершенно не~повлияет на поведение других стратегий. К~примеру, можно добавить в~первую и пятую группы продукций бесполезные продукции. Тогда получим следующее группы продукций:  $S\rightarrow ABC \mid T$ и $S\rightarrow AB \mid AC \mid T$. Таким образом, при создании нового слова глупая стратегия коротки слов всегда будет выбирать бесполезную продукцию. Результаты проведения игр с~использованием новой грамматики можно увидеть в таблице~\ref{table:anti_gsks}. Как видно, стратегия ни разу не победила.


\begin{table}[h!]
	\centering
	\caption{Распределение побед в играх с грамматикой, сконструированной специально против ГСКС}
	\label{table:anti_gsks}\stepcounter{tablenum}
	\begin{tabular}{| c | c | c | c | c | c | c | c | c |}
		\hline
		Противник         & ГСКС & СС   & УСС  & УУСС & СКС  & ПС1  & ПС4  & АСС10 \\ \hline
		ГСКС первый игрок & 0/0  & 0/20 & 0/20 & 0/20 & 0/20 & 0/20 & 0/20 & 0/20  \\ \hline
		ГСКС второй игрок & 0/0  & 20/0 & 20/0 & 20/0 & 20/0 & 20/0 & 20/0 & 20/0  \\ \hline
	\end{tabular}
\end{table}


Стратегия коротких слов показывает себя плохо из-за того, что она слишком ориентирована на~получение выводов с~наименьшим количеством шагов. 

Переборная стратегия в~обеих своих вариациях показывает себя хорошо. Хотя ПС1 ведёт перебор всего на один шаг вперёд, но этого уже достаточно чтобы обойти все остальные стратегии. Тем не менее, ПС4 значительно увеличивает отрыв от~других стратегий. Так, ПС4 можно назвать строго доминирующей стратегией.

Также можно отметить, что очерёдность хода игроков почти не влияет на результат. А имеющаяся разница может быть объяснена влиянием случайности.

Теперь поговорим об~адаптивной случайной стратегии. Отметим, что у переборной стратегии результативность прямо пропорциональна основному параметру — глубине перебора. У~адаптивной случайной стратегии связь результативности с~параметром~$\Omega$ устроена сложнее. При слишком низком значении параметра~$\Omega$ стратегия будет слишком поздно переходить ко~второму этапу и будет не~успевать заканчивать выводы. При~большом значении параметра стратегия будет слишком рано переходить на~второй этап и будет вести себя как переборная стратегия.

Для~нахождения оптимального значения параметра отвечающего за~смену поведения, проведём исследование. Переберём значения параметра на~отрезке от~1 до~20 и будем смотреть на~количество побед в~играх против переборной стратегии. Переборная стратегия выбрана в~качестве оппонента как самая сильная из~остальных представленных стратегий. Также сразу рассмотрим эффективность применения стратегии коротких слов на~втором этапе. Результаты исследования можно увидеть на~Рис.~\ref{fig:aac_params}. При~каждом значении параметра проводилось~500 партий с~использованием грамматики c~низким шансом выпадения начальных продукций. На графике сплошной линией обозначена доля побед в~играх с~использованием ПС на~втором этапе, пунктирной линией --- с~использованием СКС на~втором этапе. 

\begin{figure}[!b]
	\centering
	\includegraphics[width=\textwidth]{omega.png}
	\caption{Доля побед ААС в~зависимости от~параметра $\Omega$}
	\label{fig:aac_params}\stepcounter{fignum}
\end{figure}

По результатам можно сказать, что при увеличении параметра до~10 результативность растёт. При~использовании ПС на~втором этапе рост результативности останавливается при значениях параметра больше~10, а при значениях больше~20 результативность начинает падать. При~использовании СКС на втором этапе результативность начинает падать уже после~10. Таким образом, 10 является оптимальным значением параметра. Также использование~ПС на~втором этапе является более предпочтительным.

Теперь взглянем на результаты этой стратегии, приведённые в~таблице~\ref{table:highfreq}. Стратегия показывает себя на~уровне ПС4. Но на~данной грамматике это вполне ожидаемый и хороший результат.

\begin{table}[!h]
	\smaller
	\centering
	\setlength\tabcolsep{1.6pt}
	\caption{Распределение побед в турнире с использованием грамматики с~низким шансом выпадения начальных продукций}
	\label{table:lowfreq}\stepcounter{tablenum}
	\centering
	\begin{tabular}{| c | c | c | c | c | c | c | c | c |}
		\hline
		      & СС         & УСС        & УУСС      & ГСКС      & СКС        & ПС1       & ПС4        & AAC10     \\ \hline
		СС    & 250/238/12 & 219/275/6  & 199/297/4 & 185/313/2 & 268/232/0  & 185/306/9 & 153/341/6  & 91/405/4  \\ \hline
		УСС   & 270/227/3  & 246/250/4  & 166/332/2 & 97/398/5  & 375/116/9  & 172/327/1 & 118/380/2  & 74/423/3  \\ \hline
		УУСС  & 305/192/3  & 305/186/9  & 249/244/7 & 181/318/1 & 380/117/3  & 259/238/3 & 198/300/2  & 100/399/1 \\ \hline
		ГСКС  & 349/145/6  & 384/115/1  & 321/177/2 & 265/233/2 & 435/61/4   & 357/140/3 & 314/184/2  & 120/378/2 \\ \hline
		СКС   & 228/269/3  & 141/349/10 & 90/408/2  & 75/423/2  & 233/227/40 & 62/436/2  & 30/468/2   & 55/443/2  \\ \hline
		ПС1   & 313/183/4  & 300/196/4  & 233/266/1 & 142/354/4 & 430/68/2   & 261/230/9 & 202/294/4  & 64/435/1  \\ \hline
		ПС4   & 352/141/7  & 378/116/6  & 286/209/5 & 200/298/2 & 460/39/1   & 333/164/3 & 244/244/12 & 89/410/1  \\ \hline
		AAC10 & 406/93/1   & 420/79/1   & 397/102/1 & 374/122/4 & 446/53/1   & 434/65/1  & 396/103/1  & 228/270/2 \\ \hline
	\end{tabular}
\end{table}

Теперь взглянем на~результат в~таблице~\ref{table:lowfreq} проведения турнира с~использованием грамматики с~низким шансом выпадения начальных продукций. 

Выделяется явный фаворит в~лице адаптивной случайной стратегии. Она даже подходит на место строго доминирующей стратегии.

Также выделяются плохие показатели стратегии коротких слов. Она даже в партиях со~случайной стратегий чаще проигрывает, чем побеждает. Причиной этого является та же проблема слишком быстрого получения сентенций. 

Снова довольно хорошо показывает себя глупая стратегия коротких слов, это происходит всё потому~же, из-за недостатка метрики~\ref{metric1}, который выражается в построении не самых коротких выводов. Но в~такой ситуации этот~недостаток скорее является преимуществом. Важно подчеркнуть что можно сконструировать грамматику специально против этой стратегии, что уже было проделано ранее.

Можно отметить уменьшение отрыва переборной стратегии от всех остальных. Это показывает ухудшение эффективности данной стратегии на грамматиках такого вида, что вполне объяснимо, ведь эта стратегия так же, как и другие стремится строить кратчайшие выводы. Тем не менее, можно подчеркнуть, что при большой (или неограниченной) глубине перебора, эта стратегия смогла бы показывать намного лучшие результаты, но из-за ограничений времени это невозможно.

Теперь исследуем смешанные стратегии. В формировании смешанных стратегий будут участвовать не все чистые стратегии. Будут взяты лишь лучшие представители: улучшенная умная случайная стратегия, стратегия коротких слов, переборная стратегия и адаптивная случайная стратегия.

Для упрощения записи будем сокращать название смешанной стратегии до СмС~(поскольку СС уже занято случайной стратегией) и перечисления весов. К примеру смешанная стратегия с очками вероятности равными единице будет записана как СмС 1 1 1 1. 

Получим распределения очков вероятности, используя метод <<Процент от~побед>>. По результатам из~таблицы~\ref{table:highfreq}: УУСС $= 1581$, СКС $= 1177$, ПС $= 2706$, ААС $= 2263$, такую смешанную стратегию сократим до ПП1. А по~результатам из~таблицы~\ref{table:lowfreq}: УУСС~$=~1890$, СКС $= 844$, ПС $= 2194$, ААС $= 2746$, такую смешанную стратегию сократим до ПП2. 

В соответствии с правилом <<Линейный рост>> рассмотрим 4 вариации раздачи очков вероятности: Смс 2 1 3 4, СмС 1 0 2 3, СмС 2 1 4 3, СмС 1 0 3 2. 

В соответствии с~равилом <<Пики>> рассмотрим такие вариации раздачи очков вероятности: СмС 1 1 1 5, СмС 1 1 5 1, СмС 1 1 1 10, СмС 1 1 10 1.

Сначала проанализируем результаты турнира с~использованием грамматики со~средним шансом выпадения начальных продукций, которе приведена в таблице~\ref{table:smeshigh}. Все рассмотренные смешанные стратегии имеют схожие результаты. Все они проигрывают переборной стратегии или играют с ней наравне. И даже в~играх смешанных стратегий со смешанными стратегиями нет победителей. С~другими стратегиями они показывали результаты хуже переборной стратегии или на~уровне переборной стратегии.

Далее рассмотрим результаты турнира с~низким шансом выпадения начальных продукций, которые приведены в~таблице~\ref{table:smeslow}. Все стратегии проигрывают адаптивной случайной стратегии. В партиях среди смешанных стратегий лучше всего себя показывают варианты СмС~1~1~1~10 и СмС~1~1~1~5. И в целом можно отметить зависимость: лучше себя показывают стратегии, у которых больше очки вероятности, назначенные адаптивной случайной стратегии. Это показывает, что на данной грамматике наиболее эффективной является адаптивная случайная стратегия.

По результатам рассмотрения смешанных стратегий, основанных на вероятностном выборе, можно сказать, что они не являются эффективными. Это вполне объяснимо, поскольку у нас имеется почти строго доминирующая стратегия. При смешивании такой стратегии с другими получается лишь ослабленная вариация изначально хорошей стратегии. Также это может быть связано с тем, что все стратегии, кроме адаптивной случайной стратегии, направлены на~получение коротких выводов и при их смешении не получается строить более длинные выводы.

\newpage
\chapternonum{Заключение}
%\addcontentsline{toc}{section}{Заключение}

В ходе работы получилось разработать эффективные стратегии для игры в~подстановки для разных типов грамматик.

Адаптивная случайная стратегия уверенно показывает себя в~играх с~грамматиками с~низким шансом выпадения начальных продукций. И показывает себя не хуже других в~играх с~грамматиками со~средним шансом выпадения продукций. И может быть рекомендована как самая выгодная стратегия.

Смешанные стратегии, основанные на вероятностном смешении, оказались неэффективными. Это объясняется наличием строго доминирующей стратегии. В~данной ситуации повышение эффективности должно достигаться не смешением имеющихся стратегий, а качественным улучшением поведения стратегии, что и получилось сделать в~адаптивной случайной стратегии.

В будущих исследованиях можно рассмотреть вопрос создания новых стратегий. Также можно рассмотреть варианты модернизации алгоритма переборной стратегии для оптимизации. А также рассмотреть вариации <<Игры в подстановки>> с другими правилами.

% Если нужно, меняем название Литература
\renewcommand{\bibname}{Список литературы} 

\begin{thebibliography}{}
% Если нужно сделать N. вместо [N] 
% \makeatletter\renewcommand{\@biblabel}[1]{#1.}\makeatother
	\bibitem{litlink1}  Соколов В.~А. Введение в теорию формальных языков. Ярославль: ЯрГУ, 2014.
	\bibitem{litlink2}  Захаров А.~В. Теория игр в общественных науках. М.: ВШЭ, 2015.
	\bibitem{site1} Эрудит (игра) [Электронный~ресурс] URL: \url{https://dic.academic.ru/dic.nsf/ruwiki/1213567} (дата обращения: 20.05.2023)
	\bibitem{site2} Goldwater D. Number Scrabble --- the Game (aka: Math Scrabble) [Электронный ресурс] URL: \url{https://www.instructables.com/Number-Scrabble-The-Game-aka-Math-Scrabble/} (дата обращения: 22.05.2023)
	\bibitem{site3} Cosse C. Tux Math Scrabble [Электронный ресурс] URL: \url{ https://sourceforge.net/projects/tuxmathscrabble/} (дата обращения: 20.05.2023)
	\bibitem{Schuster:2017} \selectlanguage{german}
		Schuster~M. Context-free games on strings and nested words: Dissertation // Technischen Universit\"at Dortmund an der Fakult\"at f\"ur Informatik, 2017. URl:~\url{http://dx.doi.org/10.17877/DE290R-18135}.
		\selectlanguage{russian}
%		 \selectlanguage{english}
%		Schuster~M.
%		Context-free Games on Strings and Nested Words
%		//, 2017. 214p.
%		URl:~\url{http://dx.doi.org/10.17877/DE290R-18135}
%		\selectlanguage{russian}
	\bibitem{Kruglikov2024} Кругликов А. М., Смирнов А. В. Разработка стратегий для игры «Укроти мустанга» // Путь в науку: прикладная математика, информатика и информационные технологии : Тезисы докладов Всероссийской молодёжной научно-практической конференции, Ярославль, 15–19 апреля 2024 года. – Ярославль: ЯРГУ, 2024. – С. 28-31.
\end{thebibliography}

% Приложения

\appendix
\chapter{Таблицы турниров смешанных стратегий}% c грамматикой с средним шансом выпадения начальных продукций

\begin{table}[!hb]
	\smaller
	\renewcommand{\theadfont}{\smaller\bfseries}
	\rotatebox{90}{
	\begin{minipage}{0.82\textheight}
	\setlength\tabcolsep{2pt}
	
	\caption{Таблица турнира смешанных стратегий c грамматикой с средним шансом выпадения начальных продукций}
	\label{table:smeshigh}\stepcounter{tablenum}
	\begin{tabular}{| c | c | c | c | c | c | c | c | c | c | c | c | c | c | c | c |}
		\hline
		&\thead{ПП1}&\thead{ПП2}&\thead{СмС\\1 1 1 1}&\thead{СмС\\ 2 1 3 4}&\thead{СмС\\ 1 0 2 3}&\thead{СмС\\ 2 1 4 3}&\thead{СмС\\ 1 0 3 2}&\thead{СмС\\ 1 1 1 5}&\thead{СмС\\ 1 1 5 1}&\thead{СмС\\ 1 1 1 10}&\thead{СмС\\ 1 1 10 1}&\thead{ПС4}&\thead{АСС10}&\thead{УУСС}&\thead{СКС}\\
		\hline
		\thead{ПП1}&50/49/1&43/57/0&51/49/0&49/50/1&53/47/0&42/56/2&48/52/0&43/56/1&46/54/0&51/49/0&44/56/0&41/58/1&44/55/1&73/27/0&81/19/0\\
		\hline
		\thead{ПП2}&51/49/0&54/45/1&64/36/0&42/57/1&49/50/1&48/51/1&52/48/0&48/51/1&49/50/1&39/59/2&45/55/0&41/58/1&40/59/1&84/16/0&76/24/0\\
		\hline
		\thead{СмС\\1 1 1 1}&44/55/1&39/61/0&60/39/1&46/53/1&48/51/1&42/58/0&38/62/0&38/61/1&41/59/0&48/52/0&43/57/0&33/64/3&41/59/0&85/15/0&80/20/0\\
		\hline
		\thead{СмС\\ 2 1 3 4}&50/48/2&52/46/2&46/54/0&46/54/0&48/50/2&50/49/1&50/50/0&48/52/0&50/48/2&53/46/1&36/64/0&41/59/0&45/54/1&70/30/0&73/26/1\\
		\hline
		\thead{СмС\\ 1 0 2 3}&58/42/0&55/43/2&53/45/2&43/56/1&52/46/2&54/45/1&54/45/1&49/51/0&49/50/1&55/44/1&48/52/0&46/53/1&48/52/0&80/20/0&81/19/0\\
		\hline
		\thead{СмС\\ 2 1 4 3}&33/67/0&57/42/1&50/49/1&44/54/2&44/54/2&42/55/3&45/54/1&53/47/0&39/61/0&51/47/2&53/46/1&40/60/0&49/50/1&75/23/2&82/17/1\\
		\hline
		\thead{СмС\\ 1 0 3 2}&53/46/1&47/52/1&63/36/1&58/42/0&52/46/2&60/40/0&53/45/2&53/45/2&59/41/0&52/48/0&62/38/0&46/54/0&58/42/0&76/23/1&79/19/2\\
		\hline
		\thead{СмС\\ 1 1 1 5}&46/54/0&50/49/1&52/48/0&52/47/1&51/47/2&54/46/0&49/51/0&50/49/1&52/46/2&50/50/0&41/58/1&49/51/0&37/63/0&82/18/0&74/26/0\\
		\hline
		\thead{СмС\\ 1 1 5 1}&48/51/1&59/41/0&63/36/1&45/54/1&60/40/0&53/46/1&45/54/1&58/40/2&48/51/1&48/51/1&42/58/0&44/56/0&57/42/1&73/27/0&92/8/0\\
		\hline
		\thead{СмС\\ 1 1 1 10}&46/54/0&54/45/1&47/52/1&47/53/0&51/47/2&50/49/1&43/53/4&54/46/0&45/54/1&45/55/0&48/51/1&34/63/3&57/42/1&84/16/0&65/35/0\\
		\hline
		\thead{СмС\\ 1 1 10 1}&49/50/1&60/38/2&57/42/1&60/39/1&56/44/0&55/44/1&54/46/0&50/50/0&42/58/0&44/55/1&50/48/2&46/54/0&43/57/0&82/18/0&89/11/0\\
		\hline
		\thead{ПС4}&57/42/1&55/43/2&60/39/1&53/47/0&51/49/0&52/48/0&49/50/1&51/46/3&58/42/0&56/44/0&56/44/0&X&X&X&X\\
		\hline
		\thead{АСС10}&54/46/0&62/37/1&54/46/0&54/45/1&48/51/1&53/46/1&53/47/0&56/44/0&49/49/2&48/52/0&50/49/1&X&X&X&X\\
		\hline
		\thead{УУСС}&19/81/0&21/79/0&29/69/2&27/72/1&26/73/1&13/86/1&14/84/2&19/81/0&19/81/0&21/79/0&19/81/0&X&X&X&X\\
		\hline
		\thead{СКС}&21/78/1&23/76/1&18/81/1&14/85/1&24/75/1&21/79/0&13/87/0&21/78/1&12/88/0&24/74/2&11/87/2&X&X&X&X\\
		\hline
	\end{tabular}
	\end{minipage}
	}
\end{table}



\begin{table}[!hb]
	\smaller
	\renewcommand{\theadfont}{\smaller\bfseries}
	\setlength\tabcolsep{6pt}
	\rotatebox{90}{
	\begin{minipage}{\textheight}
	
	\caption{Таблица турнира смешанных стратегий c грамматикой с средним шансом выпадения начальных продукций}
	\label{table:smeslow}\stepcounter{tablenum}
	\begin{tabular}{| c | c | c | c | c | c | c | c | c | c | c | c | c | c | c | c |}
		\hline
		&\thead{ПП1}&\thead{ПП2}&\thead{СмС\\1 1 1 1}&\thead{СмС\\ 2 1 3 4}&\thead{СмС\\ 1 0 2 3}&\thead{СмС\\ 2 1 4 3}&\thead{СмС\\ 1 0 3 2}&\thead{СмС\\ 1 1 1 5}&\thead{СмС\\ 1 1 5 1}&\thead{СмС\\ 1 1 1 10}&\thead{СмС\\ 1 1 10 1}&\thead{ПС4}&\thead{АCС10}&\thead{УУСС}&\thead{СКС}\\
		\hline
		\thead{ПП1}&46/53/1&44/56/0&60/37/3&36/62/2&43/57/0&47/53/0&43/57/0&35/65/0&39/59/2&28/72/0&49/50/1&51/48/1&21/78/1&66/34/0&88/11/1\\
		\hline
		\thead{ПП2}&55/44/1&53/46/1&72/28/0&45/53/2&45/54/1&53/47/0&44/56/0&45/55/0&61/38/1&33/67/0&47/53/0&54/45/1&26/74/0&60/39/1&90/10/0\\
		\hline
		\thead{СмС\\1 1 1 1}&37/62/1&39/60/1&55/45/0&38/62/0&30/69/1&37/62/1&45/55/0&45/55/0&44/55/1&31/69/0&52/47/1&42/57/1&16/83/1&61/38/1&86/14/0\\
		\hline
		\thead{СмС\\ 2 1 3 4}&64/36/0&52/48/0&60/40/0&52/48/0&38/61/1&55/45/0&50/50/0&35/65/0&58/41/1&32/68/0&62/37/1&59/41/0&29/71/0&66/33/1&91/8/1\\
		\hline
		\thead{СмС\\ 1 0 2 3}&57/42/1&54/46/0&71/28/1&55/44/1&47/53/0&63/37/0&59/40/1&52/47/1&71/29/0&35/63/2&63/37/0&57/41/2&37/63/0&68/32/0&98/2/0\\
		\hline
		\thead{СмС\\ 2 1 4 3}&53/46/1&48/51/1&60/40/0&38/61/1&35/64/1&48/52/0&43/57/0&41/59/0&51/47/2&33/67/0&58/41/1&50/48/2&20/80/0&69/30/1&92/8/0\\
		\hline
		\thead{СмС\\ 1 0 3 2}&54/45/1&55/45/0&62/38/0&53/47/0&43/55/2&49/50/1&47/53/0&54/46/0&51/47/2&36/64/0&61/39/0&60/40/0&31/69/0&66/33/1&93/7/0\\
		\hline
		\thead{СмС\\ 1 1 1 5}&62/38/0&60/40/0&70/27/3&45/54/1&46/53/1&60/40/0&53/47/0&52/48/0&62/38/0&45/54/1&58/42/0&67/33/0&35/64/1&73/26/1&87/13/0\\
		\hline
		\thead{СмС\\ 1 1 5 1}&52/48/0&41/58/1&55/45/0&41/58/1&35/64/1&33/67/0&46/53/1&34/65/1&42/57/1&27/72/1&57/42/1&42/58/0&31/68/1&62/38/0&89/11/0\\
		\hline
		\thead{СмС\\ 1 1 1 10}&66/34/0&54/45/1&73/27/0&63/37/0&50/50/0&66/34/0&63/37/0&65/35/0&75/25/0&49/51/0&74/26/0&71/29/0&43/55/2&78/22/0&86/14/0\\
		\hline
		\thead{СмС\\ 1 1 10 1}&50/49/1&37/63/0&55/45/0&45/55/0&31/67/2&41/59/0&42/56/2&47/53/0&49/51/0&30/70/0&44/53/3&48/52/0&21/79/0&63/36/1&89/11/0\\
		\hline
		\thead{ПС4}&51/48/1&47/53/0&57/42/1&44/55/1&37/63/0&51/49/0&54/45/1&36/62/2&48/51/1&31/68/1&48/52/0&X&X&X&X\\
		\hline
		\thead{АCС10}&75/24/1&73/27/0&74/26/0&75/23/2&73/27/0&69/30/1&75/25/0&71/28/1&76/24/0&55/44/1&74/25/1&X&X&X&X\\
		\hline
		\thead{УУСС}&44/55/1&35/65/0&42/56/2&31/69/0&33/67/0&42/57/1&33/66/1&39/60/1&35/65/0&22/78/0&38/61/1&X&X&X&X\\
		\hline
		\thead{СКС}&12/87/1&11/88/1&19/81/0&4/96/0&12/88/0&7/93/0&10/89/1&11/89/0&15/85/0&6/93/1&7/93/0&X&X&X&X\\
		\hline
	\end{tabular}
	\end{minipage}
}
\end{table}


% Настраиваем общее для всех языков оформление листинга
\lstset{ %
	language=Python,                % Язык программирования 
	%	extendedchars=\true,
	columns=fullflexible,
	flexiblecolumns,
	inputencoding=cp1251,
	belowcaptionskip=5pt,
	keepspaces=true,
	basicstyle=\fontsize{10pt}{10pt}\selectfont,
	commentstyle=\fontsize{10pt}{10pt}\selectfont,
	stringstyle=\bf,
	showspaces=false,               
	showstringspaces=false,         
	showtabs=false,      
	tabsize=2,                       % Tab - 2 пробела
	literate={а}{{\selectfont\char224}}1
	{б}{{\selectfont\char225}}1
	{в}{{\selectfont\char226}}1
	{г}{{\selectfont\char227}}1
	{д}{{\selectfont\char228}}1
	{е}{{\selectfont\char229}}1
	{ё}{{\"e}}1
	{ж}{{\selectfont\char230}}1
	{з}{{\selectfont\char231}}1
	{и}{{\selectfont\char232}}1
	{й}{{\selectfont\char233}}1
	{к}{{\selectfont\char234}}1
	{л}{{\selectfont\char235}}1
	{м}{{\selectfont\char236}}1
	{н}{{\selectfont\char237}}1
	{о}{{\selectfont\char238}}1
	{п}{{\selectfont\char239}}1
	{р}{{\selectfont\char240}}1
	{с}{{\selectfont\char241}}1
	{т}{{\selectfont\char242}}1
	{у}{{\selectfont\char243}}1
	{ф}{{\selectfont\char244}}1
	{х}{{\selectfont\char245}}1
	{ц}{{\selectfont\char246}}1
	{ч}{{\selectfont\char247}}1
	{ш}{{\selectfont\char248}}1
	{щ}{{\selectfont\char249}}1
	{ъ}{{\selectfont\char250}}1
	{ы}{{\selectfont\char251}}1
	{ь}{{\selectfont\char252}}1
	{э}{{\selectfont\char253}}1
	{ю}{{\selectfont\char254}}1
	{я}{{\selectfont\char255}}1
	{А}{{\selectfont\char192}}1
	{Б}{{\selectfont\char193}}1
	{В}{{\selectfont\char194}}1
	{Г}{{\selectfont\char195}}1
	{Д}{{\selectfont\char196}}1
	{Е}{{\selectfont\char197}}1
	{Ё}{{\"E}}1
	{Ж}{{\selectfont\char198}}1
	{З}{{\selectfont\char199}}1
	{И}{{\selectfont\char200}}1
	{Й}{{\selectfont\char201}}1
	{К}{{\selectfont\char202}}1
	{Л}{{\selectfont\char203}}1
	{М}{{\selectfont\char204}}1
	{Н}{{\selectfont\char205}}1
	{О}{{\selectfont\char206}}1
	{П}{{\selectfont\char207}}1
	{Р}{{\selectfont\char208}}1
	{С}{{\selectfont\char209}}1
	{Т}{{\selectfont\char210}}1
	{У}{{\selectfont\char211}}1
	{Ф}{{\selectfont\char212}}1
	{Х}{{\selectfont\char213}}1
	{Ц}{{\selectfont\char214}}1
	{Ч}{{\selectfont\char215}}1
	{Ш}{{\selectfont\char216}}1
	{Щ}{{\selectfont\char217}}1
	{Ъ}{{\selectfont\char218}}1
	{Ы}{{\selectfont\char219}}1
	{Ь}{{\selectfont\char220}}1
	{Э}{{\selectfont\char221}}1
	{Ю}{{\selectfont\char222}}1
	{Я}{{\selectfont\char223}}1
}


\chapter{Исходный код программы на C\#}
\label{code}
% Запустить encode-files.bat чтобы скопировать и перекодировать необходимые файлы
\lstinputlisting[breaklines]{./code/ProductionGroup.cs}
\lstinputlisting[breaklines]{./code/Grammatic.cs}
\lstinputlisting[breaklines]{./code/GameSettings.cs}
\lstinputlisting[breaklines]{./code/Bank.cs}
\lstinputlisting[breaklines]{./code/Move.cs}
\lstinputlisting[breaklines]{./code/PrimaryMove.cs}
\lstinputlisting[breaklines]{./code/Parameters.cs}
\lstinputlisting[breaklines]{./code/SimplifiedWord.cs}
\lstinputlisting[breaklines]{./code/SimplifiedProductionGroup.cs}
\lstinputlisting[breaklines]{./code/Simplifier.cs}
\lstinputlisting[breaklines]{./code/StrategyUtilitiesClass.cs}
\lstinputlisting[breaklines]{./code/Strategy.cs}
\lstinputlisting[breaklines]{./code/SmartRandomStrategy.cs}
\lstinputlisting[breaklines]{./code/StupidShortWordsStrategy.cs}
\lstinputlisting[breaklines]{./code/ShortWordsStrategy.cs}
\lstinputlisting[breaklines]{./code/SearchStrategy.cs}
\lstinputlisting[breaklines]{./code/RandomStrategy.cs}
\lstinputlisting[breaklines]{./code/RandomSettings.cs}
\lstinputlisting[breaklines]{./code/RandomProvider.cs}
\lstinputlisting[breaklines]{./code/MixedStrategy.cs}
\lstinputlisting[breaklines]{./code/AdaptiveRandomStrategy.cs}
\lstinputlisting[breaklines]{./code/Game.cs}


\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%
% Конец документа
%%%%%%%%%%%%%%%%%%%%%%%%%%
